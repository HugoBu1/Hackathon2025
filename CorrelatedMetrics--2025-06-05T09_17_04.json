{"title":"Correlated Metrics","description":"End to end overview of the systems supporting the \"Find Correlated Metrics\" feature available from the context menu of timeseries graph in the UI.","widgets":[{"id":4781548385807292,"definition":{"title":"Usage and SLOs","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":541087633600308,"definition":{"title":"Searches started","type":"query_value","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:dd.correlations.search_started{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"custom_bg","custom_bg_color":"#c7eaff"}]}],"autoscale":true,"precision":2,"timeseries_background":{"yaxis":{},"type":"bars"}},"layout":{"x":0,"y":0,"width":3,"height":2}},{"id":3900719128599158,"definition":{"title":"Searches completed","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"percent"}},"formula":"(query1 / query2) * 100"}],"queries":[{"query":"count:dd.correlations.result_tile_count{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:dd.correlations.search_started{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"custom_bg","custom_bg_color":"#d1edff"}]}],"autoscale":true,"precision":1,"timeseries_background":{"type":"area"}},"layout":{"x":3,"y":0,"width":3,"height":2}},{"id":6342231079233094,"definition":{"title":"Total search duration (avg)","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"p50 + query1"}],"queries":[{"data_source":"metrics","name":"p50","query":"avg:trace.flask.request{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}","aggregator":"avg"},{"data_source":"metrics","name":"query1","query":"avg:dd.correlations.search_duration{$org_id,$datacenter}","aggregator":"avg"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"custom_bg","custom_bg_color":"#e0f3ff"}]}],"autoscale":true,"precision":1,"timeseries_background":{"type":"area","yaxis":{"include_zero":true}}},"layout":{"x":6,"y":0,"width":3,"height":2}},{"id":4779176355220992,"definition":{"title":"Results per search (avg)","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"avg:dd.correlations.result_tile_count{$org_id,$datacenter}","data_source":"metrics","name":"query1","aggregator":"avg"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"custom_bg","custom_bg_color":"#f0f9ff"}]}],"autoscale":true,"precision":1,"timeseries_background":{"type":"area"}},"layout":{"x":9,"y":0,"width":3,"height":2}},{"id":480094967970596,"definition":{"title":"POST endpoint","type":"slo","slo_id":"712a01cb8e82532db1230c0839b24418","view_type":"detail","view_mode":"overall","time_windows":["7d"],"show_error_budget":true,"global_time_target":"0","additional_query_filters":"$org_id,$datacenter"},"layout":{"x":0,"y":2,"width":2,"height":2}},{"id":7766125651464936,"definition":{"title":"GET endpoint","type":"slo","slo_id":"414ed309ac3155e49b66ecfa0f095bd6","view_type":"detail","view_mode":"overall","time_windows":["7d"],"show_error_budget":true,"global_time_target":"0","additional_query_filters":"$org_id,$datacenter"},"layout":{"x":2,"y":2,"width":2,"height":2}},{"id":7451314077699866,"definition":{"title":"Searches completed before timeout","type":"slo","slo_id":"e1cb7ac1483c588baadc56c8e2052fc3","view_type":"detail","view_mode":"overall","time_windows":["7d","30d"],"show_error_budget":true,"global_time_target":"0","additional_query_filters":"$org_id,$datacenter"},"layout":{"x":4,"y":2,"width":4,"height":2}},{"id":3917439000287938,"definition":{"title":"delancie-correlations jobs","type":"slo","slo_id":"6aa7c1e9a7e55f35858df9140b720190","view_type":"detail","view_mode":"overall","time_windows":["7d"],"show_error_budget":true,"global_time_target":"0","additional_query_filters":"$org_id,$datacenter"},"layout":{"x":8,"y":2,"width":4,"height":2}}]},"layout":{"x":0,"y":0,"width":12,"height":5}},{"id":5103176570881688,"definition":{"title":"Creating Searches (mcnulty-query)","background_color":"vivid_purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":5255474847565190,"definition":{"type":"note","content":"#### All correlations endpoints APM metrics","background_color":"purple","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":2559764800078518,"definition":{"title":"Hits by endpoint","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.flask.request.hits{service:mcnulty-query-py3,resource_name:*correlations*,$org_id,$datacenter} by {resource_name}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":1,"width":3,"height":2}},{"id":836411954808234,"definition":{"title":"Errors by endpoint","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"data_source":"metrics","name":"query2","query":"sum:trace.flask.request.errors{service:mcnulty-query-py3,resource_name:*correlations*,$org_id,$datacenter} by {resource_name}.as_count()"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":1,"width":3,"height":2}},{"id":1460192933159170,"definition":{"title":"Error rate by endpoint","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query2","query":"sum:trace.flask.request.errors{service:mcnulty-query-py3,resource_name:*correlations*,$org_id,$datacenter} by {resource_name}.as_count()","aggregator":"sum"},{"data_source":"metrics","name":"query1","query":"sum:trace.flask.request.hits{service:mcnulty-query-py3,resource_name:*correlations*,$org_id,$datacenter} by {resource_name}.as_count()","aggregator":"sum"}],"response_format":"scalar","conditional_formats":[{"comparator":">=","value":5,"palette":"white_on_red"},{"comparator":">=","value":1,"palette":"white_on_yellow"},{"comparator":">=","value":0,"palette":"white_on_green"}],"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"percent"}},"formula":"query2 / query1 * 100"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"red"}},"layout":{"x":6,"y":1,"width":3,"height":2}},{"id":2170376013891586,"definition":{"title":"Latency by endpoint","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"p50","query":"avg:trace.flask.request{service:mcnulty-query-py3,resource_name:*correlations*,$org_id,$datacenter} by {resource_name}","aggregator":"avg"}],"response_format":"scalar","conditional_formats":[{"comparator":">=","value":5,"palette":"white_on_red"},{"comparator":">","value":2,"palette":"white_on_yellow"},{"comparator":">","value":0,"palette":"white_on_green"}],"formulas":[{"formula":"p50"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"layout":{"x":9,"y":1,"width":3,"height":2}},{"id":5356469388573134,"definition":{"type":"note","content":"#### POST Endpoint","background_color":"purple","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":3,"width":12,"height":1}},{"id":2654621523416120,"definition":{"title":"Hits & Errors","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Hits","formula":"query1"},{"alias":"Errors","style":{"palette":"warm","palette_index":5},"formula":"-query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.flask.request.hits{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:trace.flask.request.errors{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":3,"height":2}},{"id":2818345528327088,"definition":{"title":"Latency","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"P50","formula":"p50"},{"alias":"P75","formula":"p75"},{"alias":"P90","formula":"p90"},{"alias":"P95","formula":"p95"}],"queries":[{"data_source":"metrics","name":"p50","query":"p50:trace.flask.request{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}"},{"data_source":"metrics","name":"p75","query":"p75:trace.flask.request{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}"},{"data_source":"metrics","name":"p90","query":"p90:trace.flask.request{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}"},{"data_source":"metrics","name":"p95","query":"p95:trace.flask.request{service:mcnulty-query-py3,resource_name:post_/api/v1/correlations,$org_id,$datacenter}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear"}},"layout":{"x":3,"y":4,"width":3,"height":2}},{"id":3052638004786636,"definition":{"title":"Rate Limits","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Global rate limit","formula":"query1"},{"alias":"User short-rate limit","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.dogweb.rate_limit_impact{rate_limit_short_name:correlations_search,$org_id,$datacenter} by {org_id}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:dd.dogweb.rate_limit_impact{rate_limit_short_name:correlations_search_user,$org_id,$datacenter} by {org_id}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":4,"width":3,"height":2}},{"id":4440598739754082,"definition":{"title":"Users hitting rate limits","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"logs_pattern_stream","query_string":"\"[correlations][start_search] User\" \"has too many active searches.\" service:mcnulty-query-py3 -\"string_query_structured\" $org_id $datacenter","indexes":[],"group_by":[{"facet":"service"}]},"columns":[{"field":"status_line","width":"auto"},{"field":"matches","width":"auto"},{"field":"volume","width":"auto"},{"field":"service","width":"auto"},{"field":"message","width":"auto"}]}],"type":"list_stream"},"layout":{"x":9,"y":4,"width":3,"height":2}}]},"layout":{"x":0,"y":5,"width":12,"height":7}},{"id":7297392615083216,"definition":{"title":"Search Initialization Jobs (delancie-correlations)","background_color":"vivid_pink","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":5741992026834214,"definition":{"type":"note","content":"#### Delancie metrics (correlations-init jobs)","background_color":"pink","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":4160902033032808,"definition":{"title":"Init Jobs Enqueued","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Jobs enqueued","formula":"query1"}],"queries":[{"data_source":"logs","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[],"search":{"query":"\"Correlations initialisation: a new query has been enqueued\" service:mcnulty-query-py3 -\"string_query_structured\" $org_id $datacenter"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":1,"width":3,"height":2}},{"id":850665051816854,"definition":{"title":"Jobs Waiting (avg)","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":2},"formula":"query2"}],"queries":[{"query":"avg:delancie.jobs.waiting{flavor:correlations,job:correlations-init,$org_id,$datacenter}","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":1,"width":3,"height":2}},{"id":2319811484133470,"definition":{"title":"Jobs Started","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:delancie.jobs.started{flavor:correlations,job:correlations-init ,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":6,"y":1,"width":3,"height":2}},{"id":1364990582281862,"definition":{"title":"Jobs Completed","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:delancie.jobs.completed{flavor:correlations,job:correlations-init ,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":1,"width":3,"height":2}},{"id":114508895572738,"definition":{"title":"Jobs Duration (avg)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:delancie.jobs.run_time.avg{flavor:correlations, job:correlations-init, $org_id,$datacenter}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":3,"width":3,"height":2}},{"id":3153974583776310,"definition":{"title":"Init job timeout reached","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"\"[correlations][get_search_results] Init search\" \"has expired\" -\"string_query_structured\" $org_id $datacenter service:mcnulty-query-py3 "},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"orange","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":3,"width":3,"height":2}},{"id":3151609745438910,"definition":{"title":"Jobs Failed","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Failed job","formula":"query2"}],"queries":[{"query":"sum:delancie.jobs.failed{flavor:correlations,job:correlations-init,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":6,"y":3,"width":3,"height":2}},{"id":888480349854126,"definition":{"title":"Failure Rate","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"100 * (query1 + query2) / (query1 + query2 + query3)"}],"queries":[{"query":"sum:delancie.jobs.failed{flavor:correlations,job:correlations-init,$datacenter,$org_id}.as_count()","data_source":"metrics","name":"query1"},{"query":"sum:delancie.job.uncaught_exception{flavor:correlations,job:correlations-init ,$datacenter,$org_id}.as_count()","data_source":"metrics","name":"query2"},{"query":"sum:delancie.jobs.completed{flavor:correlations,job:correlations-init ,$datacenter,$org_id}.as_count()","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":9,"y":3,"width":3,"height":2}},{"id":7365940038874938,"definition":{"type":"note","content":"#### Starting Searches","background_color":"pink","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":5,"width":12,"height":1}},{"id":368110837,"definition":{"title":"Searches started","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.search_started{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":0,"y":6,"width":3,"height":2}},{"id":6886934901594844,"definition":{"title":"Jobs Generated","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.enqueued_jobs_by_type{execution_origin:user,$org_id,$datacenter} by {candidate_type}.as_count()"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":6,"width":3,"height":2}},{"id":6611564551534026,"definition":{"title":"Candidates / Search","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1 / query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.enqueued_jobs_by_type{execution_origin:user,$org_id,$datacenter}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:dd.ds.researcher.get_correlations_search_signal_finder_jobs{execution_origin:user,$org_id,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":6,"width":3,"height":2}},{"id":618640097766452,"definition":{"title":"Max candidates reached","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":1},"formula":"query1"}],"queries":[{"data_source":"logs","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[],"search":{"query":"service:delancie-correlations -\"string_query_structured\" \"candidates. Results limited to\" $org_id $datacenter"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":9,"y":6,"width":3,"height":2}},{"id":3455374243179686,"definition":{"title":"Empty ref series","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":2},"formula":"query1"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"service:delancie-correlations -\"string_query_structured\" \"Ref series for query\" $org_id $datacenter "},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":8,"width":3,"height":2}},{"id":2232939081095310,"definition":{"title":"Empty searches","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"logs","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[],"search":{"query":"\"[correlations][start_search] No signal finder jobs for correlations search.\" service:delancie-correlations -\"string_query_structured\" $org_id $datacenter"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":8,"width":3,"height":2}},{"id":2980794862176454,"definition":{"title":"Errors logs","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":4},"alias":"Failed to enqueue jobs","formula":"query1"},{"style":{"palette":"warm","palette_index":5},"alias":"Failed to query ref series","formula":"query2"},{"style":{"palette":"warm","palette_index":6},"alias":"Failed to query ref series","formula":"query3"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"service:delancie-correlations -\"string_query_structured\" \"[correlations][start_search] Failed to start search for\" $org_id $datacenter "},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"},{"data_source":"logs","name":"query2","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[],"search":{"query":"service:delancie-correlations -\"string_query_structured\" \"[correlations][start_search] Failed to query ref series for\" $org_id $datacenter"},"storage":"hot"},{"data_source":"logs","name":"query3","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[],"search":{"query":"service:delancie-correlations -\"string_query_structured\" \"[correlations][start_search] Failed to update search status for\" $org_id $datacenter"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":8,"width":3,"height":2}},{"id":651230038379932,"definition":{"title":"Facet Tag Keys Latency","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"query":"avg:trace.dd.og.o11y.best_covering_tag_keys.duration{$org_id,$datacenter}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":9,"y":8,"width":3,"height":2}},{"id":2009679296454156,"definition":{"type":"note","content":"#### Candidates Finders","background_color":"pink","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":10,"width":12,"height":1}},{"id":4839346529282964,"definition":{"title":"Sources fetchers hits","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"spans","search":{"query":"service:delancie-correlations resource_name:(correlations.ApmServiceSourcesFetcher.* OR correlations.IntegrationSourcesFetcher.* OR correlations.DashboardSourcesFetcher.*) $org_id $datacenter "},"indexes":["*"],"group_by":[{"facet":"resource_name","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":11,"width":4,"height":2}},{"id":4123384175878866,"definition":{"title":"Sources fetchers latency (avg)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"spans","search":{"query":"service:delancie-correlations resource_name:(correlations.ApmServiceSourcesFetcher.* OR correlations.IntegrationSourcesFetcher.* OR correlations.DashboardSourcesFetcher.*) $org_id $datacenter "},"indexes":["*"],"group_by":[{"facet":"resource_name","limit":10,"sort":{"aggregation":"avg","order":"desc","metric":"@duration"},"should_exclude_missing":true}],"compute":{"aggregation":"avg","metric":"@duration"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":11,"width":4,"height":2}},{"id":5350798909352294,"definition":{"title":"Sources fetchers errors","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"spans","search":{"query":"service:delancie-correlations resource_name:(correlations.ApmServiceSourcesFetcher.* OR correlations.IntegrationSourcesFetcher.* OR correlations.DashboardSourcesFetcher.*) status:error $org_id $datacenter "},"indexes":["*"],"group_by":[{"facet":"resource_name","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"red","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":8,"y":11,"width":4,"height":2}},{"id":543313594942768,"definition":{"title":"Search strategies","type":"toplist","requests":[{"queries":[{"query":"sum:dd.ds.researcher.get_correlations_search_signal_finder_jobs{execution_origin:user,$org_id,$datacenter} by {search_strategy}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":0,"y":13,"width":2,"height":2}},{"id":3545702251561864,"definition":{"title":"Sources fetchers latency (avg)","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"spans","search":{"query":"service:delancie-correlations resource_name:(correlations.ApmServiceSourcesFetcher.* OR correlations.IntegrationSourcesFetcher.* OR correlations.DashboardSourcesFetcher.*) $org_id $datacenter "},"indexes":["*"],"group_by":[{"facet":"resource_name","limit":100,"sort":{"aggregation":"avg","order":"desc","metric":"@duration"},"should_exclude_missing":true}],"compute":{"aggregation":"avg","metric":"@duration"},"storage":"hot"}],"response_format":"scalar","conditional_formats":[{"comparator":">=","value":1000000000,"palette":"white_on_yellow"},{"comparator":">=","value":0,"palette":"white_on_green"}],"formulas":[{"formula":"query1"}],"sort":{"count":100,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"layout":{"x":2,"y":13,"width":5,"height":2}},{"id":2241039943884764,"definition":{"title":"Sources fetchers error rate (avg)","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query2","data_source":"spans","search":{"query":"service:delancie-correlations resource_name:(correlations.ApmServiceSourcesFetcher.* OR correlations.IntegrationSourcesFetcher.* OR correlations.DashboardSourcesFetcher.*) status:error $org_id $datacenter "},"indexes":["*"],"group_by":[{"facet":"resource_name","limit":100,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"},{"name":"query1","data_source":"spans","search":{"query":"service:delancie-correlations resource_name:(correlations.ApmServiceSourcesFetcher.* OR correlations.IntegrationSourcesFetcher.* OR correlations.DashboardSourcesFetcher.*) $org_id $datacenter "},"indexes":["*"],"group_by":[{"facet":"resource_name","limit":100,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","metric":"count"},"storage":"hot"}],"response_format":"scalar","conditional_formats":[{"comparator":">=","value":5,"palette":"white_on_red"},{"comparator":">=","value":2,"palette":"white_on_yellow"},{"comparator":">=","value":0,"palette":"white_on_green"}],"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"percent"}},"formula":"query2 / query1 * 100"}],"sort":{"count":200,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"layout":{"x":7,"y":13,"width":5,"height":2}}]},"layout":{"x":0,"y":12,"width":12,"height":16}},{"id":1526265519583286,"definition":{"title":"Getting Results (mcnulty-query)","background_color":"vivid_orange","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2846897173239450,"definition":{"type":"note","content":"#### GET Endpoint","background_color":"orange","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":3681267554423910,"definition":{"title":"Hits & Errors","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Hits","formula":"query1"},{"alias":"Errors","style":{"palette":"warm","palette_index":5},"formula":"-query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:trace.flask.request.hits{service:mcnulty-query-py3,resource_name:get_/api/v1/correlations/_request_id,$org_id,$datacenter}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:trace.flask.request.errors{service:mcnulty-query-py3,resource_name:get_/api/v1/correlations/_request_id,$org_id,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":1,"width":3,"height":2}},{"id":4312879609188810,"definition":{"title":"Latency","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"P50","formula":"p50"},{"alias":"P75","formula":"p75"},{"alias":"P90","formula":"p90"},{"alias":"P95","formula":"p95"}],"queries":[{"data_source":"metrics","name":"p50","query":"p50:trace.flask.request{service:mcnulty-query-py3,resource_name:get_/api/v1/correlations/_request_id,$org_id,$datacenter}"},{"data_source":"metrics","name":"p75","query":"p75:trace.flask.request{service:mcnulty-query-py3,resource_name:get_/api/v1/correlations/_request_id,$org_id,$datacenter}"},{"data_source":"metrics","name":"p90","query":"p90:trace.flask.request{service:mcnulty-query-py3,resource_name:get_/api/v1/correlations/_request_id,$org_id,$datacenter}"},{"data_source":"metrics","name":"p95","query":"p95:trace.flask.request{service:mcnulty-query-py3,resource_name:get_/api/v1/correlations/_request_id,$org_id,$datacenter}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear"}},"layout":{"x":3,"y":1,"width":3,"height":2}},{"id":7159441924898592,"definition":{"title":"Rate Limits","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Global rate limit","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.dogweb.rate_limit_impact{rate_limit_short_name:correlations_get_results,$org_id,$datacenter} by {org_id}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":1,"width":3,"height":2}},{"id":242118607331278,"definition":{"title":"Tried to query expired search","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":2},"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.get_results_no_statuses{$org_id,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":9,"y":1,"width":3,"height":2}},{"id":8505023655676336,"definition":{"type":"note","content":"#### Searches Analytics","background_color":"orange","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":3,"width":12,"height":1}},{"id":8122201929603274,"definition":{"type":"note","content":"\"Completed\" searches are searches that finished naturally or timed out, and users stayed until the end","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":0,"y":4,"width":9,"height":1}},{"id":404084406033034,"definition":{"type":"note","content":"From first job creation, to last poll from the frontend, including timeouts","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":9,"y":4,"width":3,"height":1}},{"id":4654880110570802,"definition":{"title":"Searches completed","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"count:dd.correlations.result_tile_count{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":5,"width":3,"height":2}},{"id":5636746568862304,"definition":{"title":"% Searches completed","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"% searches completed","formula":"ewma_7((query1 / query2) * 100)"}],"queries":[{"query":"count:dd.correlations.result_tile_count{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query1"},{"query":"sum:dd.correlations.search_started{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":3,"y":5,"width":3,"height":2}},{"id":2309295705964412,"definition":{"title":"Search timeouts","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:dd.correlations.searches_timed_out{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":6,"y":5,"width":3,"height":2}},{"id":3370479350572310,"definition":{"title":"Search duration (avg)","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"autosmooth(query2)"}],"queries":[{"query":"avg:dd.correlations.search_duration{$org_id,$datacenter}","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"label":" timeout ","value":"y = 180","display_type":"info dashed"}]},"layout":{"x":9,"y":5,"width":3,"height":2}},{"id":7344589796788218,"definition":{"type":"note","content":"Percentage of delancie jobs that have finished when the search is completed","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":0,"y":7,"width":3,"height":1}},{"id":1525995912590290,"definition":{"type":"note","content":"Searches that are queried from a user that did not start them","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":3,"y":7,"width":3,"height":1}},{"id":3155593202757372,"definition":{"type":"note","content":"Number of sources (groups) and results per completed search","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":6,"y":7,"width":6,"height":1}},{"id":395287036,"definition":{"title":"Average completion rate","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"avg:dd.correlations.pct_completed{$org_id,$datacenter}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":8,"width":3,"height":2}},{"id":2405747460870792,"definition":{"title":"Shared searches","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:correlations.search_shared{$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":3,"y":8,"width":3,"height":2}},{"id":5642349737372468,"definition":{"title":"Sources per completed search (avg)","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"avg:dd.correlations.result_source_count{$org_id,$datacenter}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":8,"width":3,"height":2}},{"id":2963529404715668,"definition":{"title":"Results per completed search (avg)","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"avg:dd.correlations.result_tile_count{$org_id,$datacenter}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":8,"width":3,"height":2}},{"id":2640781638509932,"definition":{"type":"note","content":"Index of the exploration option (depth) that produced the \"best\" results, by candidate type","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":0,"y":10,"width":4,"height":1}},{"id":3062780021900676,"definition":{"type":"note","content":"How many correlated groups we find in average for a candidate, using the \"best\" exploration option","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":4,"y":10,"width":4,"height":1}},{"id":3958618815918778,"definition":{"type":"note","content":"Count of all signals we end up saving, by type","background_color":"gray","font_size":"12","text_align":"center","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"bottom","has_padding":true},"layout":{"x":8,"y":10,"width":4,"height":1}},{"id":6044751742710542,"definition":{"title":"Best Exploration Options","type":"toplist","requests":[{"style":{"palette":"dog_classic"},"response_format":"scalar","queries":[{"query":"sum:dd.correlations.scoped_search_results{$org_id,$datacenter} by {candidate_type,depth}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"formula":"query1"}],"sort":{"count":50,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked"},"palette":"dog_classic"}},"layout":{"x":0,"y":11,"width":4,"height":2}},{"id":2875928288360632,"definition":{"title":"Correlated groups per candidate","type":"toplist","requests":[{"style":{"palette":"dog_classic"},"response_format":"scalar","queries":[{"query":"sum:dd.correlations.scoped_search_n_correlated_results{$datacenter,$org_id} by {candidate_type}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:dd.correlations.scoped_search_results{$datacenter,$org_id} by {candidate_type}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"formulas":[{"formula":"query1 / query2"}],"sort":{"order_by":[{"type":"formula","index":0,"order":"desc"}],"count":10}}],"style":{}},"layout":{"x":4,"y":11,"width":4,"height":2}},{"id":3847118238869828,"definition":{"title":"Signal/Job Types","type":"toplist","requests":[{"response_format":"scalar","queries":[{"query":"sum:dd.correlations.signals_saved{execution_origin:user,$org_id,$datacenter} by {job_type}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{}},"layout":{"x":8,"y":11,"width":4,"height":2}}]},"layout":{"x":0,"y":28,"width":12,"height":14}},{"id":4367239266777444,"definition":{"title":"CorrelatedMetricJobs (delancie-correlations)","background_color":"vivid_yellow","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":3170558590929712,"definition":{"type":"note","content":"#### Jobs Enqueuing","background_color":"yellow","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":76517028948716,"definition":{"title":"Jobs Enqueued","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.signal_finder.delancie.enqueue_job{execution_origin:user,$datacenter,$org_id} by {job_type}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":1,"width":3,"height":2}},{"id":368110842,"definition":{"title":"Enqueuing Errors","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.delancie_exception{flavor:correlations,$org_id,$datacenter} by {exception_name}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":3,"y":1,"width":3,"height":2}},{"id":5710808529346818,"definition":{"title":"Jobs dropped before reaching a delancie worker","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.lost_jobs{$datacenter,$org_id}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":1,"width":3,"height":2}},{"id":2867751309361984,"definition":{"title":"Deadline Aborts (Processed too late)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.deadline_aborts{execution_origin:user,$org_id,$datacenter} by {org_id}.as_count()"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":9,"y":1,"width":3,"height":2}},{"id":3335126523623928,"definition":{"title":"Jobs Waiting (avg)","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":2},"formula":"query2"}],"queries":[{"query":"avg:delancie.jobs.waiting{flavor:correlations,job:correlations-query,$org_id,$datacenter}","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":3,"width":4,"height":2}},{"id":6351699415700634,"definition":{"title":"Jobs Queue Duration (avg)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:dd.correlations.job_queue_duration{execution_origin:user,$org_id,$datacenter}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":3,"width":4,"height":2}},{"id":368110847,"definition":{"title":"Queues with waiting jobs (avg)","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"autosmooth(query1)"}],"queries":[{"query":"avg:delancie.queues.waiting{job:correlations-query,flavor:correlations,$org_id,$datacenter}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":8,"y":3,"width":4,"height":2}},{"id":2981088011741090,"definition":{"type":"note","content":"#### Jobs Processing","background_color":"yellow","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":5,"width":12,"height":1}},{"id":5425593530047548,"definition":{"title":"Jobs Started","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:delancie.jobs.started{flavor:correlations,job:correlations-query,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":6,"width":3,"height":2}},{"id":2819025501534266,"definition":{"title":"Correlations SFJs Processed","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.rca.signal_finder_jobs{execution_origin:user,$org_id,$datacenter} by {job_type}.as_count()"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":6,"width":3,"height":2}},{"id":8183269812267020,"definition":{"title":"Jobs Duration (avg)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:dd.correlations.job_duration{execution_origin:user,$org_id,$datacenter} by {job_type}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":6,"width":3,"height":2}},{"id":7296634813646852,"definition":{"title":"Jobs Completed","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:delancie.jobs.completed{flavor:correlations,job:correlations-query,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":6,"width":3,"height":2}},{"id":1471992587486972,"definition":{"title":"Jobs Failed","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query2"}],"queries":[{"query":"sum:delancie.jobs.failed{flavor:correlations,job:correlations-query,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":8,"width":3,"height":2}},{"id":368110840,"definition":{"title":"Exceptions from metrics-query","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.query_exception{$org_id AND $datacenter AND (service:delancie-correlations OR service:mcnulty-query-py3)} by {service}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":8,"width":3,"height":2}},{"id":7521794350855687,"definition":{"title":"Exceptions from metrics-query","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"logs_pattern_stream","query_string":"\"Correlations metric query failed\" service:delancie-correlations $org_id $datacenter","indexes":[],"group_by":[]},"columns":[{"field":"status_line","width":"auto"},{"field":"matches","width":"auto"},{"field":"volume","width":"auto"},{"field":"message","width":"auto"}]}],"type":"list_stream"},"layout":{"x":6,"y":8,"width":3,"height":2}},{"id":8898038908123794,"definition":{"title":"Failure Rate","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"100 * query1 / (query1 + query2)"}],"queries":[{"query":"sum:delancie.jobs.failed{flavor:correlations,job:correlations-query,$datacenter,$org_id}.as_count()","data_source":"metrics","name":"query1"},{"query":"sum:delancie.jobs.completed{flavor:correlations,job:correlations-query,$datacenter,$org_id}.as_count()","data_source":"metrics","name":"query2"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":9,"y":8,"width":3,"height":2}},{"id":692036967222636,"definition":{"type":"note","content":"#### Queries","background_color":"yellow","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":10,"width":12,"height":1}},{"id":979172693071502,"definition":{"title":"String queries run","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.scoped_queries_run{$datacenter,$org_id,service:delancie-correlations} by {candidate_type}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":0,"y":11,"width":4,"height":2}},{"id":935668677229614,"definition":{"title":"Rocky queries run","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.metrics.query.rocky.requests{$datacenter AND (query_source:correlations) AND $org_id} by {query_source}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":11,"width":4,"height":2}},{"id":5128215059356006,"definition":{"title":"Metrics Query cache coverage","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"100 * query1","number_format":{"unit":{"type":"canonical_unit","unit_name":"percent"}}}],"queries":[{"query":"avg:dist.metrics.query_cache.cache_coverage_rate{$datacenter,$org_id,query_source:correlations} by {query_source}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":8,"y":11,"width":4,"height":2}},{"id":3720978621529832,"definition":{"type":"note","content":"#### Results Processing","background_color":"yellow","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":13,"width":12,"height":1}},{"id":5549707860959966,"definition":{"title":"True Positives","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.passed_range_filter{is_from_watchdog:false,$org_id,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"green","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":14,"width":6,"height":2}},{"id":5337733906301820,"definition":{"title":"False Positives","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"warm","palette_index":2},"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.failed_range_filter{is_from_watchdog:false,$org_id,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":14,"width":6,"height":2}},{"id":2582616142576680,"definition":{"title":"Jobs that found no signal","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.no_signals{execution_origin:user,$org_id,$datacenter} by {job_type}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":0,"y":16,"width":3,"height":2}},{"id":2991830688576576,"definition":{"title":"Job Failures","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:dd.correlations.signal_finder_job_failures{execution_origin:user,$org_id,$datacenter} by {exception_name,job_type}.as_count()"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":3,"y":16,"width":3,"height":2}},{"id":25033337885030,"definition":{"title":"Signals found","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:dd.correlations.signals_saved{execution_origin:user,$org_id,$datacenter} by {job_type}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":6,"y":16,"width":3,"height":2}},{"id":2756127416763414,"definition":{"title":"Error Logs (All Correlations Failures)","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"logs_pattern_stream","query_string":"\"Signal finder job\" \"failed with exception:\" service:delancie-correlations $org_id $datacenter","indexes":[],"group_by":[]},"columns":[{"field":"status_line","width":"auto"},{"field":"matches","width":"auto"},{"field":"volume","width":"auto"},{"field":"message","width":"auto"}]}],"type":"list_stream"},"layout":{"x":9,"y":16,"width":3,"height":2}},{"id":475582930707348,"definition":{"type":"note","content":"#### Workers (for all delancie-correlations)","background_color":"yellow","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":18,"width":12,"height":1}},{"id":5316483811062356,"definition":{"title":"Active workers","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"query":"sum:dd.delancie.worker.check.non_idle_worker_count{$datacenter,flavor:correlations,kube_namespace:delancie,$org_id} by {datacenter}","data_source":"metrics","name":"query1"}],"formulas":[{"formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":0,"y":19,"width":3,"height":2}},{"id":368110846,"definition":{"title":"Avg % workers active","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"100 * query1 / query2"}],"response_format":"timeseries","queries":[{"query":"sum:dd.delancie.worker.check.non_idle_worker_count{$datacenter,service:delancie-correlations,kube_namespace:delancie,$org_id} by {datacenter}.rollup(avg)","data_source":"metrics","name":"query1"},{"query":"sum:dd.delancie.worker.check.total_worker_count{$datacenter,service:delancie-correlations,kube_namespace:delancie,$org_id} by {datacenter}.rollup(avg)","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"value":"y = 100","display_type":"error solid"},{"value":"y = 80","display_type":"warning dashed"}]},"layout":{"x":3,"y":19,"width":3,"height":2}},{"id":829368564168726,"definition":{"title":"(Workers) Memory limits/requests/used","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"limits","formula":"query3"}],"queries":[{"query":"max:kubernetes.memory.limits{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"thick"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"requests","formula":"query3"}],"queries":[{"query":"max:kubernetes.memory.requests{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"thick"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"max usage","formula":"query7"}],"queries":[{"query":"max:kubernetes.memory.usage{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}.rollup(max, 60)","data_source":"metrics","name":"query7"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"dashed","line_width":"thin"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"avg usage","formula":"query3"}],"queries":[{"query":"avg:kubernetes.memory.usage{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":6,"y":19,"width":3,"height":2}},{"id":7837356544670058,"definition":{"title":"(Workers) CPU limits/requests/used","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"limits","formula":"query3"}],"queries":[{"query":"max:kubernetes.cpu.limits{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"thick"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"requests","formula":"query3"}],"queries":[{"query":"max:kubernetes.cpu.requests{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"thick"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"max usage","formula":"query3 / 1000000000"}],"queries":[{"query":"max:container.cpu.usage{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"dashed","line_width":"thin"},"display_type":"line"},{"on_right_yaxis":false,"formulas":[{"alias":"avg usage","formula":"query3 / 1000000000"}],"queries":[{"query":"avg:container.cpu.usage{service:delancie-correlations,$datacenter,kube_container_name:delancie-worker} by {datacenter}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":19,"width":3,"height":2}},{"id":3831112014075087,"definition":{"title":"Containers CPU Usage %","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"((query12 / 1000000000) / query13) * 100"}],"queries":[{"query":"max:container.cpu.usage{$datacenter,service:delancie-correlations} by {kube_container_name}","data_source":"metrics","name":"query12"},{"query":"max:kubernetes.cpu.limits{$datacenter,service:delancie-correlations} by {kube_container_name}","data_source":"metrics","name":"query13"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"label":" 100% ","value":"y > 100","display_type":"error dashed"},{"label":" 80% ","value":"80 < y < 100","display_type":"warning dashed"}]},"layout":{"x":0,"y":21,"width":3,"height":2}},{"id":3729474095590158,"definition":{"title":"Containers Memory Usage %","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"response_format":"timeseries","queries":[{"query":"max:kubernetes.memory.usage_pct{$datacenter,service:delancie-correlations} by {container_name}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"max":"1.1"},"markers":[{"label":" 80% ","value":"y > 0.8","display_type":"warning dashed"},{"label":" 95% ","value":"y > 0.95","display_type":"error dashed"}]},"layout":{"x":3,"y":21,"width":3,"height":2}},{"id":2668603453795048,"definition":{"title":"Error Logs","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"logs_pattern_stream","query_string":"status:error service:delancie-correlations","indexes":[],"storage":"hot","clustering_pattern_field_path":"message","group_by":[{"facet":"service"}]},"columns":[{"field":"status_line","width":"auto"},{"field":"matches","width":"auto"},{"field":"volume","width":"auto"},{"field":"service","width":"auto"},{"field":"message","width":"auto"}]}],"type":"list_stream"},"layout":{"x":0,"y":23,"width":12,"height":3}}]},"layout":{"x":0,"y":42,"width":12,"height":27,"is_column_break":true}},{"id":4167066403840152,"definition":{"title":"Cache & Storage","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6205390120177142,"definition":{"type":"note","content":"#### Cassandra (cass-data-science)\n\nUsed to keep track of correlated metric jobs","background_color":"green","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":4628655385586510,"definition":{"title":"Read Latency","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"p99","formula":"query1"}],"queries":[{"query":"avg:cassandra.read_latency.99th_percentile{cluster:cass-data-science,app:cassandra,$datacenter,keyspace:cfa,$org_id}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"},{"formulas":[{"alias":"p95","formula":"query1"}],"queries":[{"query":"avg:cassandra.read_latency.95th_percentile{cluster:cass-data-science,app:cassandra,$datacenter,keyspace:cfa,$org_id}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"line"},{"formulas":[{"alias":"mean","formula":"query1"}],"queries":[{"query":"avg:cassandra.read_latency.mean{cluster:cass-data-science,app:cassandra,$datacenter,keyspace:cfa,$org_id}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"label":"reads > 20ms","value":"y > 20000","display_type":"warning dashed"}]},"layout":{"x":0,"y":1,"width":3,"height":2}},{"id":8066367533018422,"definition":{"title":"Write Latency","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1","number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}}}],"queries":[{"query":"avg:cassandra.write_latency.99th_percentile{cluster:cass-data-science,app:cassandra,$datacenter,keyspace:cfa,$org_id}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"line"},{"formulas":[{"formula":"query1","number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}}}],"queries":[{"query":"avg:cassandra.write_latency.95th_percentile{cluster:cass-data-science,app:cassandra,$datacenter,keyspace:cfa,$org_id}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"line"},{"formulas":[{"formula":"query1","number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}}}],"queries":[{"query":"avg:cassandra.write_latency.mean{cluster:cass-data-science,app:cassandra,$datacenter,keyspace:cfa,$org_id}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"label":" writes > 200μs ","value":"y > 200","display_type":"warning dashed"}]},"layout":{"x":3,"y":1,"width":3,"height":2}},{"id":4850522836936250,"definition":{"title":"Errors / Request Type","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Unavailable","formula":"query1"},{"alias":"Failure","formula":"query2"},{"alias":"Timeout","formula":"query3"}],"queries":[{"query":"sum:cassandra.unavailables.count{$datacenter,cluster:cass-data-science,$org_id} by {clientrequest}","data_source":"metrics","name":"query1"},{"query":"sum:cassandra.failures.count{$datacenter,cluster:cass-data-science,$org_id} by {clientrequest}","data_source":"metrics","name":"query2"},{"query":"sum:cassandra.timeouts.count{$datacenter,cluster:cass-data-science,$org_id} by {clientrequest}","data_source":"metrics","name":"query3"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":6,"y":1,"width":3,"height":2}},{"id":228106273209998,"definition":{"title":"Requests Success Percentage","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"100 * (1 - (per_second(query1) + per_second(query2) + per_second(query3)) / per_second(query4))"}],"response_format":"timeseries","queries":[{"query":"sum:cassandra.timeouts.count{$datacenter,cluster:cass-data-science,$org_id}","data_source":"metrics","name":"query1"},{"query":"sum:cassandra.failures.count{$datacenter,cluster:cass-data-science,$org_id}","data_source":"metrics","name":"query2"},{"query":"sum:cassandra.unavailables.count{$datacenter,cluster:cass-data-science,$org_id}","data_source":"metrics","name":"query3"},{"query":"sum:cassandra.latency.count{$datacenter,cluster:cass-data-science,$org_id}","data_source":"metrics","name":"query4"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":9,"y":1,"width":3,"height":2}},{"id":5944743167987028,"definition":{"type":"note","content":"#### Postgres (dogweb-backend / correlations_search)\n\n[TODO Update with new queries]","background_color":"green","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":3,"width":12,"height":1}},{"id":8326735468089526,"definition":{"title":"\"Create Search\" Queries","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"postgresql_queries_count"}],"queries":[{"query":"sum:postgresql.queries.count{query_signature:e93bac485610a3f4,$org_id,$datacenter}.as_count()","data_source":"metrics","name":"postgresql_queries_count"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":3,"height":2}},{"id":6220428114651492,"definition":{"title":"\"Create Search\" Queries Duration","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"postgresql_queries_time"}],"queries":[{"query":"sum:postgresql.queries.time{query_signature:e93bac485610a3f4,$org_id,$datacenter}.as_count().fill(linear, 90)","data_source":"metrics","name":"postgresql_queries_time"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":3,"y":4,"width":3,"height":2}},{"id":3265152252876364,"definition":{"title":"\"Get Search\" Queries Duration","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:postgresql.queries.count{query_signature:14f43c32dec283f1,$org_id,$datacenter}.as_count().fill(linear, 90)","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":4,"width":3,"height":2}},{"id":8165515604607638,"definition":{"title":"\"Get Search\" Queries Duration","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"postgresql_queries_time"}],"queries":[{"query":"sum:postgresql.queries.time{query_signature:14f43c32dec283f1,$org_id,$datacenter}.as_count().fill(linear, 90)","data_source":"metrics","name":"postgresql_queries_time"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":9,"y":4,"width":3,"height":2}},{"id":7226594622224858,"definition":{"type":"note","content":"#### Ephemera (correlations-ref-series)\n\nUsed to cache reference timeseries data for all correlated metric jobs","background_color":"green","font_size":"12","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":0,"y":6,"width":12,"height":1}},{"id":1371087220122184,"definition":{"title":"Client Request Rate","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Request Rate","formula":"query3"}],"queries":[{"data_source":"metrics","name":"query3","query":"sum:dd.ephemera.client.count{$datacenter,cache:correlations-ref-series,service:delancie-correlations}.as_rate()"}],"response_format":"timeseries","style":{"palette":"dog_cat","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[],"custom_links":[{"label":"View Client Service","link":"/services?currentTopTab=Ownership&selectedService={{service.value}}"}]},"layout":{"x":0,"y":7,"width":3,"height":2}},{"id":639473865167216,"definition":{"title":"Hits & Misses","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Hit","formula":"query4"},{"alias":"Miss","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query4","query":"sum:dd.ephemera.client.hit{service:delancie-correlations,cache:correlations-ref-series,$datacenter}.as_count()"},{"data_source":"metrics","name":"query1","query":"sum:dd.ephemera.client.miss{service:delancie-correlations,cache:correlations-ref-series,$datacenter}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"min":"auto","max":"auto"},"markers":[],"custom_links":[{"label":"View Client Service","link":"/services?currentTopTab=Ownership&selectedService={{service.value}}"}]},"layout":{"x":3,"y":7,"width":3,"height":2}},{"id":673786251075098,"definition":{"title":"Client Errors","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query4"}],"queries":[{"data_source":"metrics","name":"query4","query":"sum:dd.ephemera.client.error{$datacenter,cache:correlations-ref-series,service:delancie-correlations} by {error_type}.as_count()"}],"response_format":"timeseries","style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[],"custom_links":[{"label":"View Client Service","link":"/services?currentTopTab=Ownership&selectedService={{service.value}}"}]},"layout":{"x":6,"y":7,"width":3,"height":2}},{"id":1502561269325662,"definition":{"title":"Latency (by method)","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"p90","formula":"query2"},{"alias":"p99","formula":"query1"},{"alias":"p50","formula":"query3"}],"queries":[{"data_source":"metrics","name":"query2","query":"p90:dd.ephemera.client.latency_us{cache:correlations-ref-series,$datacenter} by {method}"},{"data_source":"metrics","name":"query1","query":"p99:dd.ephemera.client.latency_us{cache:correlations-ref-series,$datacenter} by {method}"},{"data_source":"metrics","name":"query3","query":"p50:dd.ephemera.client.latency_us{cache:correlations-ref-series,$datacenter} by {method}"}],"response_format":"timeseries","style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[],"custom_links":[]},"layout":{"x":9,"y":7,"width":3,"height":2}}]},"layout":{"x":0,"y":69,"width":12,"height":10}}],"template_variables":[{"name":"org_id","prefix":"org_id","available_values":["2"],"default":"*"},{"name":"datacenter","prefix":"datacenter","available_values":["ap1.prod.dog","eu1.prod.dog","us1.prod.dog","us3.prod.dog","us5.prod.dog"],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed","tags":["team:data-science-augmented-troubleshooting"]}