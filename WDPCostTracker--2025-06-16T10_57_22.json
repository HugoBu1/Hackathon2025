{"title":"WDP Cost Tracker","description":"[[suggested_dashboards]]","widgets":[{"id":4506712215988714,"definition":{"title":"Global cost","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6228482245943798,"definition":{"title":"Total cost by DC over period","title_size":"16","title_align":"left","requests":[{"response_format":"scalar","queries":[{"query":"sum:cost_tracker.private_pod_cost.count{($service OR (service:cassandra AND $cassandra_cluster) OR (service:kafka AND $kafka_cluster) OR (service:data-science-job-store-redis))} by {datacenter}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"formula":"query1"}]}],"type":"sunburst"},"layout":{"x":0,"y":0,"width":6,"height":4}},{"id":6707993465963560,"definition":{"title":"Weekly cost over time (last 3 months)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"live_span":"3mo"},"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:cost_tracker.private_pod_cost.count{$service AND ($service OR (service:cassandra AND $cassandra_cluster) OR (service:kafka AND $kafka_cluster))} by {datacenter}.as_count().rollup(sum, 604800)","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":6,"y":0,"width":6,"height":4}},{"id":3568972278800751,"definition":{"title":"cost vs last month","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"hide_incomplete_cost_data":true},"type":"timeseries","requests":[{"formulas":[{"alias":"daily cost vs prev month","formula":"ccm_top_viz_query - calendar_shift(query1, '-4w', 'Europe/Paris')"}],"queries":[{"query":"sum:all.cost{$service} by {service}.rollup(sum, 86400)","data_source":"cloud_cost","name":"ccm_top_viz_query"},{"query":"sum:all.cost{$service} by {service}.rollup(sum, 86400)","data_source":"cloud_cost","name":"query1"}],"response_format":"timeseries","style":{"order_by":"values"},"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":6,"height":4}}]},"layout":{"x":0,"y":0,"width":12,"height":9}},{"id":2289977861714340,"definition":{"title":"Datadog costs","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":3493663431228814,"definition":{"type":"note","content":"This is the cost of metrics submitted by our services.\n\nPlease note that this rely on a very approximate list of metric prefixes to identify metrics coming from our code so this is not a perfect science!","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":6,"height":2}},{"id":2147700571312372,"definition":{"title":"Metrics: estimated annual cost","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1 / 100 * 0.023 * 12"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:datadog.estimated_usage.metrics.custom.by_metric{(metric_name:dd.signal_bundler* OR metric_name:dd.researcher* OR metric_name:dd.ds.rca* OR metric_name:dd.ds.dsp_query* OR metric_name:dd.ds.narrative_query* OR metric_name:dd.resource_locker* OR metric_name:dd.ds.lock* OR metric_name:dd.aggregate_clusterer.* OR metric_name:signal_aggregate_matcher.*)}","aggregator":"avg"}],"response_format":"scalar"}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area"}},"layout":{"x":6,"y":0,"width":6,"height":2}},{"id":4271355966061828,"definition":{"title":"Metrics: estimated annual cost by metric","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}},"formula":"query1 / 100 * 0.023 * 12"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:datadog.estimated_usage.metrics.custom.by_metric{(metric_name:dd.signal_bundler* OR metric_name:dd.researcher* OR metric_name:dd.ds.rca* OR metric_name:dd.ds.cfa* OR metric_name:dd.ds.dsp_query* OR metric_name:dd.ds.narrative_query* OR metric_name:dd.aggregate_clusterer.* OR metric_name:signal_aggregate_matcher.* OR metric_name:dd.correlation* OR metric_name:dd.watchdog_insight* OR metric_name:dd.ds.narrator* )} by {metric_name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":2,"width":12,"height":4}},{"id":3202765982278156,"definition":{"title":"Metrics: estimated annual cost by metric","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}},"formula":"query1 / 100 * 0.023 * 12"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:datadog.estimated_usage.metrics.custom.by_metric{metric_name:dd.signal_bundler* OR metric_name:dd.researcher* OR metric_name:dd.ds.rca* OR metric_name:dd.ds.cfa* OR metric_name:dd.ds.dsp_query* OR metric_name:dd.ds.narrative_query* OR metric_name:dd.aggregate_clusterer.* OR metric_name:signal_aggregate_matcher.* OR metric_name:dd.correlation* OR metric_name:dd.watchdog_insight* OR metric_name:dd.ds.narrator*} by {metric_name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":0,"y":6,"width":12,"height":4}},{"id":2083821914155740,"definition":{"title":"Metrics: estimated annual cost by metric","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:datadog.estimated_usage.metrics.custom.by_metric{(metric_name:dd.signal_bundler* OR metric_name:dd.researcher* OR metric_name:dd.ds.rca* OR metric_name:dd.ds.dsp_query* OR metric_name:dd.ds.narrative_query* OR metric_name:dd.aggregate_clusterer.* OR metric_name:signal_aggregate_matcher.* OR metric_name:dd.correlation* OR metric_name:dd.watchdog_insight*)} by {metric_name}","aggregator":"avg"}],"response_format":"scalar","formulas":[{"formula":"query1 / 100 * 0.07 * 12"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"layout":{"x":0,"y":10,"width":12,"height":4}}]},"layout":{"x":0,"y":9,"width":12,"height":15}},{"id":2379832758919622,"definition":{"title":"Per datacenter","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":1422802389483606,"definition":{"title":"Total cost by service over period","title_size":"16","title_align":"left","requests":[{"response_format":"scalar","queries":[{"query":"sum:cost_tracker.private_pod_cost.count{$datacenter AND ($service OR (service:cassandra AND $cassandra_cluster) OR (service:kafka AND $kafka_cluster) OR service:data-science-job-store-redis)} by {service,cluster}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"formula":"query1"}]}],"type":"sunburst","legend":{"type":"table"}},"layout":{"x":0,"y":0,"width":12,"height":4}},{"id":3602533445965126,"definition":{"title":"Cost evolution by service over time","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:cost_tracker.private_pod_cost.count{$team AND ($service OR (service:cassandra AND $cassandra_cluster) OR (service:kafka AND $kafka_cluster))} by {service}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":12,"height":4}}]},"layout":{"x":0,"y":24,"width":12,"height":9,"is_column_break":true}},{"id":5424232552184842,"definition":{"title":"Efficiency metrics","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":773873504473222,"definition":{"type":"note","content":"This is an approximation based on the signals processed by the signal-bundler and the total cost of the DSP infrastructure.\n\nAdditional efficiency metrics can be found in [this notebook](https://app.datadoghq.com/notebook/6107957/-bruno-signal-bundler-per-dc-efficiency-statistics).","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":3}},{"id":234731275127256,"definition":{"title":"Cost to process 1k signals by DC","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"metrics","query":"sum:dd.signal_bundler.signals_processed{shadow_name:none} by {datacenter}.as_count()","aggregator":"sum"},{"name":"query2","data_source":"metrics","query":"sum:cost_tracker.private_pod_cost.count{$datacenter AND team:data-science* AND ((service:signal-bundler OR service:researcher OR service:signal-updater OR service:resource-locker OR service:resource-locker-redis OR service:data-science-job-store-redis OR service:elasticsearch-bundles OR service:elasticsearch-bundles-shadow OR service:dsp-query) OR (service:cassandra AND (cluster:cassandra-signal-bundler OR cluster:cassandra-signal-bundler-shadow OR cluster:cassandra-researcher)) OR (service:kafka AND cluster:kafka-data-science*) OR (service:data-science-job-store-redis))} by {datacenter}.as_count()","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":2,"order":"desc"}]},"formulas":[{"alias":"signals processed","formula":"query1"},{"alias":"cost","formula":"query2"},{"cell_display_mode":"bar","alias":"$ for 1k signals","formula":"query2 / (query1 / 1000)"}]}]},"layout":{"x":3,"y":0,"width":9,"height":3}}]},"layout":{"x":0,"y":33,"width":12,"height":4}}],"template_variables":[{"name":"service","prefix":"service","available_values":[],"defaults":["signal-bundler","researcher","signal-updater","data-science-job-store-redis","elasticsearch-bundles","elasticsearch-bundles-shadow","dsp-query","aggregate-clusterer","signal-aggregate-matcher","narrator","watchdog-story-replicator","data-science-platform-admin","copydog","cass-watchdog-insights","watchdog-unified-insights","watchdog-unified-insights-redis","delancie-correlations","internal-watchdoginsights-api"]},{"name":"team","prefix":"team","available_values":[],"default":"data-science*"},{"name":"datacenter","prefix":"datacenter","available_values":["us1.prod.dog","eu1.prod.dog","us3.prod.dog","us5.prod.dog","ap1.prod.dog"],"default":"us1.prod.dog"},{"name":"cassandra_cluster","prefix":"cluster","available_values":[],"defaults":["cassandra-signal-bundler","cassandra-signal-bundler-shadow","cassandra-researcher","cass-signal-bundler","cass-signal-bundler-shadow","cass-researcher","cass-researcher-shadow"]},{"name":"kafka_cluster","prefix":"cluster","available_values":[],"default":"kafka-data-science*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed","tags":["team:data-science-watchdog-platform"]}